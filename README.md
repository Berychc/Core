# Микросервис Core

## Описание

Это приложение предоставляет функциональность для управления изображениями, включая загрузку, блокировку пользователей, а также тестовые операции. Пользователи могут регистрироваться и управлять своими изображениями. Модераторы имеют доступ к дополнительным функциями, таким как блокировка и разблокировка пользователей.

## Установка

1. Клонируйте репозиторий Core и Mail
2. Убедитесь, что у вас установлены все зависимости.
3. Укажите пароль входа в application.properties
4. Запустите приложения.
   

### Для запуска RabbitMQ с включенной службой управления, выполните следующую команду:

- docker run -d --hostname rmq --name rabbit-server -p 8080:15672 -p 5672:5672 rabbitmq:3-management


## Контроллеры

### 1. `ImageController`

Контроллер для работы с изображениями. Предоставляет методы для загрузки изображений и получения отфильтрованных изображений.

#### Методы

- **`POST /image/upload`**
    - Загрузка изображения, связанного с адресом электронной почты пользователя.
    - **Параметры:**
        - `file` (MultipartFile): Файл изображения, который нужно загрузить.
        - `email` (String): Адрес электронной почты пользователя, загружающего изображение.
    - **Ответ:**
        - 200 OK: "Изображение загружено успешно"

- **`GET /image/list`**
    - Получение списка изображений для конкретного пользователя с возможностью фильтрации.
    - **Параметры:**
        - `userEmail` (String): Адрес электронной почты пользователя.
        - `ids` (List<Integer>): (необязательно) Список ID изображений для фильтрации.
        - `minSize` (Long): (необязательно) Минимальный размер изображений для включения.
        - `maxSize` (Long): (необязательно) Максимальный размер изображений для включения.
        - `startDate` (Date): (необязательно) Начальная дата для фильтрации изображений.
        - `endDate` (Date): (необязательно) Конечная дата для фильтрации изображений.
        - `sortBy` (String): (необязательно) Поле для сортировки (по умолчанию "uploadDate").
        - `sortOrder` (String): (необязательно) Порядок сортировки (по умолчанию "ASC").
    - **Ответ:**
        - 200 OK: Список отфильтрованных изображений.

- **`GET /image/{imageId}/download`**
    - Скачать изображение по его ID.
    - **Параметры:**
        - `imageId` (Integer): ID изображения для скачивания.
        - `userEmail` (String): Адрес электронной почты пользователя.
    - **Ответ:**
        - Изображение скачивается в ответе.

### 2. `ModeratorController`

Контроллер для управления пользователями модераторами. Предоставляет методы для блокировки и разблокировки пользователей, а также для получения отфильтрованных изображений.

#### Методы

- **`POST /moderator/{id}/block`**
    - Блокировка пользователя по его ID.
    - **Параметры:**
        - `id` (Integer): ID пользователя, которого нужно заблокировать.
    - **Ответ:**
        - 200 OK: "Пользователь с ID X - заблокирован".

- **`POST /moderator/{id}/unblock`**
    - Разблокировка пользователя по его ID.
    - **Параметры:**
        - `id` (Integer): ID пользователя, которого нужно разблокировать.
    - **Ответ:**
        - 200 OK: "Пользователь с ID X - разблокирован".

- **`GET /moderator/list`**
    - Получение отфильтрованных изображений для модерации.
    - **Параметры:**
        - `ids` (List<Integer>): (необязательно) Список ID изображений для фильтрации.
        - `minSize` (Long): (необязательно) Минимальный размер изображений.
        - `maxSize` (Long): (необязательно) Максимальный размер изображений.
        - `startDate` (Date): (необязательно) Начальная дата.
        - `endDate` (Date): (необязательно) Конечная дата.
        - `sortBy` (String): (необязательно) Поле для сортировки (по умолчанию "uploadDate").
        - `sortOrder` (String): (необязательно) Порядок сортировки (по умолчанию "ASC").
    - **Ответ:**
        - 200 OK: Список отфильтрованных изображений.

### 3. `UserController`

Контроллер для управления пользователями.

#### Методы

- **`GET /user`**
    - Тестовое сообщение, чтобы проверить работу контроллера.
    - **Ответ:**
        - 200 OK: "Test project".

- Чтобы создать пользователя через HTTPie/Postman - Выполните этот POST запрос

>"email": "treewincsgo@gmail.com",
"password": "12345",
"role" : "MODERATOR"

- **`POST /user/register`**
    - Регистрация нового пользователя.
    - **Параметры:**
        - `userDto` (UserDto): Объект, содержащий данные пользователя для регистрации.
    - **Ответ:**
        - 200 OK: "Пользователь успешно зарегистрирован!"
        - 400 BAD REQUEST: "Ошибка: [описание ошибки]".


## Стек

- Java
- Spring Boot
- Spring Security
- Lombok
- Hibernate
- PostgreSQL
- Docker
- RabbitMq
- Swagger для документации API
## Автор

- **`Веселов Егор`**